<?php
/**
 * @file
 * This file contains all Drupal hooks for the module other than any
 * node hooks and block hooks. Those go in the [module name].chado_node.inc file
 * and [module_name].blocks.inc respectively
 *
 * @ingroup legume_stock
 */

require_once('includes/legume_stock.chado_node.inc');

function legume_stock_theme($existing, $type, $theme, $path) {
  $path = drupal_get_path('module', 'legume_stock');

  $items = array(
    'tripal_stock_base' => array(
      'variables' => array('node' => NULL),
      'template' => 'tripal_legume_stock_base',
      'path' => "$path/theme/templates",
    ),

  );

  return $items;
}//legume_stock_theme


function legume_stock_views_pre_render($view) {
//drupal_set_message("PRE RENDER VIEW:\n<pre>".print_r($view, true)."</pre>");
  if (strstr($view->name, 'stocks')) {  // Report QTL found before table
    if (isset($view->query->pager)) {
      $view->attachment_before = "<p><b>Found " . $view->query->pager->get_total_items() . " stocks</b></p>";
    }
  }

  if (isset($view->exposed_raw_input['name']))
    $search_term = $view->exposed_raw_input['name'];

  foreach ($view->result as $r) {
//drupal_set_message("RESULT:\n<pre>".print_r($r, true)."</pre>");
  }
}//legume_qtl_views_pre_render

/**
  * Form validator for search form. 
  * Use this to trim whitespace from text fields.
  */
function legume_stock_form_validate($form, &$form_state) {
  // trim whitespace from all text fields;
  if (isset($form_state['values']['name']))
    $form_state['values']['name'] = trim($form_state['values']['name']);
}//legume_stock_form_validate


/**
  * hook_views_default_views_alter()
  * Alter the default tripal_stock view.
  */
function legume_stock_views_default_views_alter(&$views) {
  $handler =& $views['tripal_stock_user_stocks']->display['default']->handler;
  
  // Remove "uniquename from results table
  $handler->display->display_options['fields']['uniquename']['exclude'] = 1;
}//legume_stock_views_default_views_alter
